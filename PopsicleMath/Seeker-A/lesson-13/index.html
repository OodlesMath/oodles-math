<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Math - Subtraction Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            overflow-x: hidden;
            background: #87CEEB; /* Sky Blue */
        }

        /* Moving clouds background effect */
        .cloud-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(180deg, #b3e5fc 0%, #e1f5fe 100%);
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 100px;
            opacity: 0.8;
            animation: moveClouds linear infinite;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        @keyframes moveClouds {
            from { transform: translateX(-200px); }
            to { transform: translateX(110vw); }
        }

        /* 3D Toy button style */
        .btn-toy {
            transition: all 0.2s;
            box-shadow: 0 8px 0 #d1d5db;
            border-radius: 24px;
            font-family: 'Poppins', sans-serif;
        }
        .btn-toy:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #d1d5db;
        }
        .btn-blue { box-shadow: 0 8px 0 #2563eb; }
        .btn-blue:active { box-shadow: 0 4px 0 #2563eb; }
        .btn-green { box-shadow: 0 8px 0 #16a34a; }
        .btn-green:active { box-shadow: 0 4px 0 #16a34a; }
        .btn-orange { box-shadow: 0 8px 0 #ea580c; }
        .btn-orange:active { box-shadow: 0 4px 0 #ea580c; }

        /* Shake animation for errors */
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Bonus Bubbles */
        .bubble {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bubble:active { transform: scale(0.8); }
        .bubble-shine {
            position: absolute;
            top: 20%;
            left: 20%;
            width: 30%;
            height: 30%;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <!-- Background Clouds -->
    <div class="cloud-bg" id="cloud-container"></div>

    <div id="game-container" class="w-full max-w-2xl px-4 py-8 relative z-10">
        <!-- Logo -->
        <div id="logo-area" class="flex justify-center mb-6 min-h-[60px]">
            <img id="game-logo" src="https://image2url.com/r2/default/images/1770270908168-036a8878-e468-415d-9a50-73d8cbcc8574.png" alt="Logo" class="max-h-24 object-contain hidden">
            <div id="logo-placeholder" class="text-blue-400/50 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                <span class="text-xs font-bold uppercase tracking-widest">Loading Logo...</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex justify-between items-end mb-2">
                <div class="bg-white px-4 py-1 rounded-full shadow-lg border-4 border-yellow-200 flex items-center gap-2">
                    <span id="level-tag" class="font-black text-yellow-600 text-sm">LEVEL 1</span>
                </div>
                <div class="bg-white px-4 py-1 rounded-full shadow-lg border-4 border-blue-200">
                    <span id="score-tag" class="font-black text-blue-500 text-sm">1 / 10</span>
                </div>
            </div>
            <div class="h-6 w-full bg-white rounded-full border-4 border-white shadow-lg overflow-hidden">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-blue-400 to-indigo-500 transition-all duration-500 w-[10%]"></div>
            </div>
        </div>

        <!-- Main Card -->
        <div id="main-card" class="bg-white/90 backdrop-blur-md rounded-[3rem] shadow-2xl p-6 md:p-10 border-[12px] border-white relative transition-all duration-300">
            
            <div id="quiz-view">
                <h2 class="text-2xl font-black text-center text-blue-500 mb-8 uppercase tracking-wide">Let's Subtract!</h2>

                <!-- Equation Area -->
                <div class="flex flex-wrap items-center justify-center gap-4 mb-8 bg-blue-50 p-6 rounded-[2.5rem] border-4 border-dashed border-blue-200">
                    <span id="num1" class="text-7xl md:text-8xl font-black text-gray-700">10</span>
                    <span class="text-5xl font-black text-blue-300">−</span>
                    <span id="num2" class="text-7xl md:text-8xl font-black text-gray-700">7</span>
                    <span class="text-5xl font-black text-blue-300">=</span>
                    <input type="number" id="answer-input" placeholder="?" 
                        class="w-24 h-24 md:w-32 md:h-32 text-center text-6xl font-black rounded-[2rem] border-[6px] border-blue-100 bg-white focus:border-blue-400 outline-none transition-all shadow-inner">
                </div>

                <!-- Counting Blocks -->
                <div class="text-center mb-8">
                    <p class="text-gray-400 font-bold mb-4 flex items-center justify-center gap-2 uppercase text-xs tracking-tight">
                        Tap <span id="target-count" class="text-blue-500 font-black">7</span> blocks to count back!
                    </p>
                    <div id="blocks-container" class="flex flex-wrap justify-center gap-2 p-4 bg-white/50 rounded-3xl">
                        <!-- Blocks generated by JS -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4">
                    <button id="check-btn" class="flex-1 py-5 bg-blue-500 hover:bg-blue-600 text-white rounded-[2rem] font-black text-2xl btn-toy btn-blue">CHECK</button>
                    <button id="reset-btn" class="px-6 py-5 bg-white text-gray-300 rounded-[2rem] font-black btn-toy border-2 border-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                    </button>
                </div>
                <button id="next-btn" class="hidden w-full py-5 bg-green-500 hover:bg-green-600 text-white rounded-[2rem] font-black text-2xl btn-toy btn-green animate-pulse">NEXT ➔</button>
            </div>

            <!-- Bonus View -->
            <div id="bonus-view" class="hidden">
                <div id="bubble-zone" class="relative w-full h-80 bg-gradient-to-b from-blue-100 to-indigo-200 rounded-[2rem] overflow-hidden border-8 border-white shadow-inner">
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-10">
                        <h3 class="text-3xl font-black text-blue-600 mb-1">BUBBLE POP!</h3>
                        <p id="bonus-target-text" class="text-blue-400 font-bold">Pop 8 more bubbles</p>
                    </div>
                </div>
            </div>

            <!-- Win View -->
            <div id="win-view" class="hidden text-center py-10">
                <div class="inline-block p-6 bg-yellow-400 rounded-full shadow-xl border-8 border-white mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                </div>
                <h1 class="text-5xl font-black text-orange-500 mb-2">YOU DID IT!</h1>
                <p class="text-xl text-gray-500 font-bold mb-8">You completed all the challenges!</p>
                <button id="restart-btn" class="w-full py-6 bg-orange-500 hover:bg-orange-600 text-white rounded-[2.5rem] font-black text-2xl btn-toy btn-orange">PLAY AGAIN</button>
            </div>

        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const LOGO_URL = "https://image2url.com/r2/default/images/1770270908168-036a8878-e468-415d-9a50-73d8cbcc8574.png"; 
        const TOTAL_LEVELS = 10;
        const BONUS_EVERY = 2;
        const BUBBLE_TARGET = 8;

        // --- STATE ---
        let state = {
            currentIndex: 0,
            score: 0,
            streak: 0,
            currentProblem: null,
            crossedOut: [],
            isBonusMode: false,
            poppedBubbles: 0
        };

        // --- SOUNDS ---
        const playSound = (type) => {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                if (type === 'correct') {
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                } else if (type === 'wrong') {
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                } else if (type === 'pop') {
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(1000, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.05);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                }
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            } catch(e) {}
        };

        // --- LOGIC ---
        const generateProblem = () => {
            const num1 = Math.floor(Math.random() * 16) + 5; 
            const num2 = Math.floor(Math.random() * (num1 - 2)) + 2; 
            return { num1, num2, ans: num1 - num2 };
        };

        const initLevel = () => {
            state.currentProblem = generateProblem();
            state.crossedOut = [];
            const input = document.getElementById('answer-input');
            input.value = '';
            input.disabled = false;
            input.classList.remove('border-green-400', 'bg-green-50', 'text-green-500', 'border-red-400', 'bg-red-50');
            
            document.getElementById('num1').innerText = state.currentProblem.num1;
            document.getElementById('num2').innerText = state.currentProblem.num2;
            document.getElementById('target-count').innerText = state.currentProblem.num2;
            
            document.getElementById('level-tag').innerText = `LEVEL ${state.currentIndex + 1}`;
            document.getElementById('score-tag').innerText = `${state.currentIndex + 1} / ${TOTAL_LEVELS}`;
            document.getElementById('progress-bar').style.width = `${((state.currentIndex + 1) / TOTAL_LEVELS) * 100}%`;
            
            document.getElementById('check-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            renderBlocks();
        };

        const renderBlocks = () => {
            const container = document.getElementById('blocks-container');
            container.innerHTML = '';
            for (let i = 0; i < state.currentProblem.num1; i++) {
                const btn = document.createElement('button');
                const isCrossed = state.crossedOut.includes(i);
                btn.className = `relative w-12 h-12 md:w-14 md:h-14 border-[5px] rounded-2xl flex items-center justify-center transition-all transform active:scale-75 ${isCrossed ? 'bg-gray-100 border-gray-200 scale-90 opacity-60' : 'bg-white border-blue-300 shadow-[0_4px_0_rgb(147,197,253)]'}`;
                
                const dot = document.createElement('div');
                dot.className = `w-4 h-4 rounded-full ${isCrossed ? 'bg-gray-300' : 'bg-blue-400'}`;
                btn.appendChild(dot);

                if (isCrossed) {
                    const x1 = document.createElement('div');
                    x1.className = "absolute inset-0 flex items-center justify-center pointer-events-none";
                    x1.innerHTML = '<div class="w-[130%] h-1 bg-red-400/80 rounded-full rotate-45 absolute"></div><div class="w-[130%] h-1 bg-red-400/80 rounded-full -rotate-45 absolute"></div>';
                    btn.appendChild(x1);
                }

                btn.onclick = () => toggleBlock(i);
                container.appendChild(btn);
            }
        };

        const toggleBlock = (index) => {
            if (document.getElementById('next-btn').classList.contains('hidden')) {
                playSound('pop');
                if (state.crossedOut.includes(index)) {
                    state.crossedOut = state.crossedOut.filter(i => i !== index);
                } else {
                    state.crossedOut.push(index);
                }
                renderBlocks();
            }
        };

        const checkAnswer = () => {
            const val = parseInt(document.getElementById('answer-input').value);
            const input = document.getElementById('answer-input');
            const card = document.getElementById('main-card');

            if (val === state.currentProblem.ans) {
                playSound('correct');
                state.score++;
                state.streak++;
                input.disabled = true;
                input.classList.add('border-green-400', 'bg-green-50', 'text-green-500');
                document.getElementById('check-btn').classList.add('hidden');
                document.getElementById('next-btn').classList.remove('hidden');
            } else {
                playSound('wrong');
                card.classList.add('shake');
                input.classList.add('border-red-400', 'bg-red-50');
                setTimeout(() => {
                    card.classList.remove('shake');
                    input.classList.remove('border-red-400', 'bg-red-50');
                }, 500);
            }
        };

        const startBonus = () => {
            state.isBonusMode = true;
            state.poppedBubbles = 0;
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('bonus-view').classList.remove('hidden');
            updateBonusText();
            spawnBubbles();
        };

        const updateBonusText = () => {
            document.getElementById('bonus-target-text').innerText = `Pop ${BUBBLE_TARGET - state.poppedBubbles} more bubbles`;
        };

        const spawnBubbles = () => {
            const zone = document.getElementById('bubble-zone');
            const loop = setInterval(() => {
                if (!state.isBonusMode) { clearInterval(loop); return; }
                
                const bubble = document.createElement('div');
                const size = Math.floor(Math.random() * 40) + 50;
                const x = Math.random() * 80 + 10;
                bubble.className = "bubble shadow-lg border-4 border-white/50 backdrop-blur-sm";
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${x}%`;
                bubble.style.bottom = `-60px`;
                bubble.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 75%)`;
                
                const shine = document.createElement('div');
                shine.className = "bubble-shine";
                bubble.appendChild(shine);

                bubble.onclick = () => {
                    playSound('pop');
                    bubble.remove();
                    state.poppedBubbles++;
                    updateBonusText();
                    if (state.poppedBubbles >= BUBBLE_TARGET) {
                        endBonus();
                    }
                };

                zone.appendChild(bubble);

                let pos = -60;
                const move = setInterval(() => {
                    pos += 2;
                    bubble.style.bottom = `${pos}px`;
                    if (pos > 400 || !state.isBonusMode) {
                        bubble.remove();
                        clearInterval(move);
                    }
                }, 16);

            }, 600);
        };

        const endBonus = () => {
            state.isBonusMode = false;
            playSound('correct');
            document.getElementById('bonus-view').innerHTML = '<div class="flex flex-col items-center justify-center h-full animate-bounce"><span class="text-6xl">✨</span><h2 class="text-4xl font-black text-blue-600">GREAT!</h2></div>';
            setTimeout(() => {
                document.getElementById('bonus-view').classList.add('hidden');
                document.getElementById('quiz-view').classList.remove('hidden');
                document.getElementById('bonus-view').innerHTML = '<div id="bubble-zone" class="relative w-full h-80 bg-gradient-to-b from-blue-100 to-indigo-200 rounded-[2rem] overflow-hidden border-8 border-white shadow-inner"><div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-10"><h3 class="text-3xl font-black text-blue-600 mb-1">BUBBLE POP!</h3><p id="bonus-target-text" class="text-blue-400 font-bold"></p></div></div>';
                advanceLevel();
            }, 1500);
        };

        const advanceLevel = () => {
            state.currentIndex++;
            if (state.currentIndex < TOTAL_LEVELS) {
                initLevel();
            } else {
                showWin();
            }
        };

        const showWin = () => {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('win-view').classList.remove('hidden');
        };

        const createClouds = () => {
            const container = document.getElementById('cloud-container');
            for (let i = 0; i < 6; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                const w = Math.random() * 100 + 100;
                const h = w * 0.4;
                cloud.style.width = `${w}px`;
                cloud.style.height = `${h}px`;
                cloud.style.top = `${Math.random() * 80}%`;
                cloud.style.left = `-${w}px`;
                cloud.style.animationDuration = `${Math.random() * 20 + 20}s`;
                cloud.style.animationDelay = `${Math.random() * 20}s`;
                
                const before = document.createElement('div');
                before.style.width = `${w*0.5}px`; before.style.height = `${w*0.5}px`;
                before.style.top = `-${w*0.25}px`; before.style.left = `${w*0.15}px`;
                before.className = "absolute bg-white rounded-full";
                cloud.appendChild(before);

                container.appendChild(cloud);
            }
        };

        window.onload = () => {
            createClouds();
            initLevel();

            const img = document.getElementById('game-logo');
            if (LOGO_URL) {
                img.onload = () => {
                    img.classList.remove('hidden');
                    document.getElementById('logo-placeholder').classList.add('hidden');
                };
                img.onerror = () => {
                    console.error("Could not load logo image");
                };
                img.src = LOGO_URL;
            }

            document.getElementById('check-btn').onclick = checkAnswer;
            document.getElementById('reset-btn').onclick = () => { playSound('pop'); state.crossedOut = []; renderBlocks(); };
            document.getElementById('next-btn').onclick = () => {
                if (state.streak > 0 && state.streak % BONUS_EVERY === 0) {
                    startBonus();
                } else {
                    advanceLevel();
                }
            };
            document.getElementById('restart-btn').onclick = () => {
                state.currentIndex = 0;
                state.score = 0;
                state.streak = 0;
                document.getElementById('win-view').classList.add('hidden');
                document.getElementById('quiz-view').classList.remove('hidden');
                initLevel();
            };
            document.getElementById('answer-input').onkeypress = (e) => {
                if(e.key === 'Enter') checkAnswer();
            };
        };
    </script>
</body>
</html>
