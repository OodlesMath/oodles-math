<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../assets/brand.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cube Builder: Multiplication Fun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f9ff;
            overflow: hidden; /* Prevents whole page scroll */
            touch-action: none;
            user-select: none;
        }
        h1, h2, .math-font {
            font-family: 'Fredoka One', cursive;
        }
        .group-zone {
            background: rgba(255, 255, 255, 0.6);
            border: 4px dashed #93c5fd;
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            padding: 8px;
            gap: 4px;
            justify-content: center;
            /* Adjusted size to fit 10 boxes without scrolling */
            width: 110px;
            height: 110px;
        }
        @media (min-width: 768px) {
            .group-zone { width: 160px; height: 160px; }
        }
        @media (min-height: 900px) {
            .group-zone { width: 180px; height: 180px; }
        }
        .group-zone.active {
            border-color: #3b82f6;
            background: rgba(219, 234, 254, 0.8);
            transform: scale(1.05);
        }
        .cube {
            width: 28px;
            height: 28px;
            border-radius: 5px;
            box-shadow: inset -2px -2px 0 rgba(0,0,0,0.1), 1px 1px 3px rgba(0,0,0,0.1);
            cursor: grab;
            position: relative;
            z-index: 10;
        }
        @media (min-width: 768px) {
            .cube { width: 38px; height: 38px; border-radius: 7px; }
        }
        .cube:active { cursor: grabbing; }
        
        .tray-cube {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            cursor: grab;
            transition: transform 0.2s;
            box-shadow: inset -5px -5px 0 rgba(0,0,0,0.1), 3px 3px 10px rgba(0,0,0,0.1);
        }
        @media (min-width: 768px) {
            .tray-cube { width: 64px; height: 64px; }
        }
        .tray-cube:hover { transform: translateY(-5px) scale(1.05); }

        .floating-bot {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        .star-anim {
            animation: starPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes starPop {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            100% { transform: scale(1.2) rotate(0); opacity: 1; }
        }

        .control-btn {
            @apply flex items-center justify-center rounded-full transition-all active:scale-90 shadow-md;
            width: 44px;
            height: 44px;
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <img src="../assets/logo-oodles-math.png" class="oodles-logo">
    <!-- Header / Task Area -->
    <header class="relative p-3 md:p-4 bg-white shadow-md flex justify-between items-center z-20 shrink-0">
        <div class="flex items-center gap-3 md:gap-4">
            <div class="w-12 h-12 md:w-16 md:h-16 bg-yellow-400 rounded-full flex items-center justify-center floating-bot border-4 border-white shadow-sm">
                <svg viewBox="0 0 24 24" class="w-8 h-8 md:w-10 md:h-10 text-white fill-current">
                    <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" />
                </svg>
            </div>
            <div>
                <p id="task-text" class="text-xl md:text-3xl text-blue-800 font-bold">Build equal groups</p>
                <p id="hint-text" class="text-xs md:text-sm text-blue-500 font-medium">Add boxes, then fill them with cubes.</p>
            </div>
        </div>
        
        <!-- Group Controls -->
        <div class="flex gap-2 md:gap-3 bg-blue-50 p-1 md:p-2 rounded-full border-2 border-blue-100">
            <button onclick="removeGroup()" class="control-btn bg-white text-red-500 hover:bg-red-50">
                <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"></path></svg>
            </button>
            <div class="flex flex-col items-center justify-center px-1 md:px-2 min-w-[50px]">
                <span class="text-[10px] font-bold text-blue-400 uppercase leading-none mb-1">Boxes</span>
                <span id="group-count-display" class="text-lg md:text-xl font-bold text-blue-700 leading-none">2</span>
            </div>
            <button onclick="addGroup()" class="control-btn bg-white text-green-500 hover:bg-green-50">
                <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"></path></svg>
            </button>
        </div>
    <!-- CENTER LOGO -->
<img
  src="https://image2url.com/r2/default/images/1770270908168-036a8878-e468-415d-9a50-73d8cbcc8574.png"
  alt="Logo"
  class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-10 md:h-14 object-contain pointer-events-none"
/>
</header>

    <!-- Main Workspace -->
    <main id="work-area" class="flex-grow p-4 md:p-6 flex flex-wrap gap-2 md:gap-4 items-center justify-center overflow-hidden relative">
        <!-- Zones will be injected here -->
    </main>

    <!-- Cube Tray -->
    <footer class="p-3 md:p-4 bg-blue-100 border-t-4 border-blue-200 shrink-0">
        <div class="max-w-4xl mx-auto flex flex-col items-center gap-3 md:gap-4">
            <div class="flex flex-col items-center">
                <p class="text-blue-600 font-bold mb-1 uppercase text-[10px] md:text-xs tracking-widest">Grab a cube:</p>
                <div id="tray" class="p-2 md:p-3 bg-white rounded-3xl shadow-inner flex justify-center border-2 border-blue-200">
                    <div class="tray-cube bg-blue-500" onpointerdown="startDrag(event, 'bg-blue-500')"></div>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button onclick="clearCanvas()" class="px-6 md:px-8 py-2 md:py-3 bg-white text-blue-600 rounded-full font-bold shadow-md hover:bg-red-50 hover:text-red-500 transition border-2 border-transparent hover:border-red-200 text-sm md:text-base">
                    Clear All
                </button>
                <button onclick="checkResult()" id="check-btn" class="px-10 md:px-12 py-2 md:py-3 bg-green-500 text-white rounded-full font-bold text-lg md:text-xl shadow-lg hover:bg-green-600 transform hover:scale-105 transition active:scale-95">
                    Check My Math!
                </button>
            </div>
        </div>
    </footer>

    <!-- Overlay for Feedback -->
    <div id="feedback-overlay" class="fixed inset-0 bg-blue-600/90 hidden z-50 flex flex-col items-center justify-center text-white p-10 text-center">
        <div class="mb-4 star-anim">
            <svg class="w-24 h-24 md:w-32 md:h-32 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>
        </div>
        <h2 class="text-3xl md:text-5xl mb-6">You Built It!</h2>
        <div id="math-sentences" class="bg-white/20 p-6 md:p-8 rounded-3xl mb-8">
            <p id="repeated-addition" class="text-2xl md:text-4xl math-font"></p>
        </div>
        <button onclick="closeFeedback()" class="px-8 md:px-12 py-3 md:py-4 bg-yellow-400 text-blue-900 rounded-full font-bold text-xl md:text-2xl shadow-xl hover:bg-yellow-300 transition transform hover:scale-110">
            Keep Building!
        </button>
    </div>

    <!-- Dragging Helper -->
    <div id="drag-proxy" class="cube fixed pointer-events-none hidden opacity-80" style="z-index: 1000;"></div>

    <script>
        const state = {
            numGroups: 2,
            groups: [0, 0], 
            dragColor: 'bg-blue-500', 
            isDragging: false,
            maxGroups: 10 // Updated to allow up to 10 boxes
        };

        const workArea = document.getElementById('work-area');
        const taskText = document.getElementById('task-text');
        const hintText = document.getElementById('hint-text');
        const dragProxy = document.getElementById('drag-proxy');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const additionDisplay = document.getElementById('repeated-addition');
        const countDisplay = document.getElementById('group-count-display');

        window.onload = () => {
            renderZones();
            updateUI();
        };

        function addGroup() {
            if (state.numGroups < state.maxGroups) {
                state.numGroups++;
                state.groups.push(0);
                renderZones();
                updateUI();
            } else {
                hintText.innerText = "Wow! 10 boxes is the limit!";
            }
        }

        function removeGroup() {
            if (state.numGroups > 1) {
                state.numGroups--;
                state.groups.pop();
                renderZones();
                updateUI();
            }
        }

        function updateUI() {
            countDisplay.innerText = state.numGroups;
            hintText.innerText = "Add cubes to make the groups equal!";
        }

        function renderZones() {
            const existingCounts = [...state.groups];
            workArea.innerHTML = '';
            
            for (let i = 0; i < state.numGroups; i++) {
                const zone = document.createElement('div');
                zone.className = 'group-zone';
                zone.dataset.index = i;
                
                zone.onclick = (e) => {
                    if (e.target.classList.contains('cube')) {
                        removeCube(i, e.target);
                    }
                };

                workArea.appendChild(zone);
                
                const count = existingCounts[i] || 0;
                for(let c = 0; c < count; c++) {
                    const cube = document.createElement('div');
                    cube.className = `cube ${state.dragColor}`; 
                    zone.appendChild(cube);
                }
            }
        }

        function removeCube(groupIndex, cubeEl) {
            cubeEl.remove();
            state.groups[groupIndex]--;
        }

        function startDrag(e, color) {
            state.isDragging = true;
            state.dragColor = color;
            dragProxy.className = `cube fixed pointer-events-none ${color} shadow-2xl`;
            dragProxy.style.display = 'block';
            updateDragPosition(e);
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('pointerup', onPointerUp);
        }

        function onPointerMove(e) {
            if (!state.isDragging) return;
            updateDragPosition(e);
            const zones = document.querySelectorAll('.group-zone');
            zones.forEach(z => {
                const rect = z.getBoundingClientRect();
                if (e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom) {
                    z.classList.add('active');
                } else {
                    z.classList.remove('active');
                }
            });
        }

        function updateDragPosition(e) {
            const offset = window.innerWidth < 768 ? 14 : 19;
            dragProxy.style.left = (e.clientX - offset) + 'px';
            dragProxy.style.top = (e.clientY - offset) + 'px';
        }

        function onPointerUp(e) {
            if (!state.isDragging) return;
            state.isDragging = false;
            dragProxy.style.display = 'none';
            const zones = document.querySelectorAll('.group-zone');
            zones.forEach(z => {
                const rect = z.getBoundingClientRect();
                if (e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom) {
                    addCubeToZone(z);
                }
                z.classList.remove('active');
            });
            window.removeEventListener('pointermove', onPointerMove);
            window.removeEventListener('pointerup', onPointerUp);
        }

        function addCubeToZone(zone) {
            const index = parseInt(zone.dataset.index);
            if (state.groups[index] >= 16) return;
            const cube = document.createElement('div');
            cube.className = `cube ${state.dragColor} animate-bounce`;
            setTimeout(() => cube.classList.remove('animate-bounce'), 500);
            zone.appendChild(cube);
            state.groups[index]++;
        }

        function checkResult() {
            const counts = state.groups;
            const first = counts[0];
            const allSame = counts.every(c => c === first && c > 0);
            const total = counts.reduce((a, b) => a + b, 0);

            if (allSame) {
                showSuccess(state.numGroups, first, total);
            } else if (total === 0) {
                hintText.innerText = "Put some cubes in the boxes first!";
            } else {
                hintText.innerText = "Almost! Make sure every box has the same number of cubes.";
            }
        }

        function showSuccess(groups, perGroup, total) {
            const addition = Array(groups).fill(perGroup).join(' + ');
            additionDisplay.innerText = `${addition} = ${total}`;
            feedbackOverlay.classList.remove('hidden');
        }

        function closeFeedback() {
            feedbackOverlay.classList.add('hidden');
        }

        function clearCanvas() {
            state.groups = Array(state.numGroups).fill(0);
            renderZones();
            hintText.innerText = "Ready to build something new!";
        }
    </script>
</body>
</html>
